# 增量上传功能使用指南

## 🚀 功能概述

增量上传功能为 Omega 更新系统提供了智能的文件差异对比和增量上传能力，只上传发生变化的文件，大大提高上传效率并支持云端文件同步。

## ✨ 主要特性

### 1. 智能文件对比
- **SHA256 哈希对比**：确保文件内容变化检测的准确性
- **文件大小和修改时间**：快速筛选可能变化的文件
- **三种变化状态**：新增、修改、删除文件的精确识别

### 2. 增量上传
- **只上传变化文件**：新增和修改的文件才会上传
- **保持文件夹结构**：完整保留原始目录结构
- **断点续传支持**：上传过程可以取消和重试

### 3. 云端文件同步
- **自动删除多余文件**：删除云端存在但本地不存在的文件
- **可选同步功能**：用户可以选择是否启用同步删除
- **安全确认机制**：删除操作需要用户明确确认

### 4. 用户友好界面
- **差异报告展示**：详细显示文件变化情况
- **进度实时显示**：上传进度和状态实时更新
- **操作日志记录**：完整的操作历史和错误日志

## 🎯 使用方法

### 1. 启动上传工具
```bash
python start_upload_tool.py
```

### 2. 配置上传参数
1. **选择文件夹**：点击"选择文件夹"按钮选择要上传的本地文件夹
2. **选择版本类型**：
   - 🟢 **稳定版 (Stable)**：生产环境使用
   - 🟡 **测试版 (Beta)**：预发布测试
   - 🔴 **新功能测试版 (Alpha)**：开发测试
3. **填写描述**：可选填写版本更新说明

### 3. 启用增量上传
1. **勾选"启用增量上传"**：激活智能对比功能
2. **配置同步选项**：
   - 勾选"启用云端同步"：自动删除云端多余文件
   - 取消勾选：仅上传变化文件，不删除云端文件

### 4. 分析文件差异
1. **点击"分析差异"按钮**：系统将对比本地和云端文件
2. **查看差异报告**：
   - 📊 **摘要信息**：显示新增、修改、删除、相同文件的数量
   - 📄 **详细列表**：分类显示具体的文件变化
   - 📦 **上传大小**：显示需要上传的总文件大小

### 5. 确认并执行上传
1. **确认差异报告**：仔细检查文件变化是否符合预期
2. **注意删除警告**：如果有文件需要删除，系统会显示警告
3. **点击确认**：开始执行增量上传
4. **监控进度**：实时查看上传进度和状态

## 📊 差异报告说明

### 摘要信息
- **🆕 新增文件**：本地存在但云端不存在的文件
- **📝 修改文件**：本地和云端都存在但内容不同的文件
- **🗑️ 删除文件**：云端存在但本地不存在的文件
- **✅ 相同文件**：本地和云端内容完全相同的文件

### 详细信息标签页
- **新增标签页**：显示所有需要新增的文件
- **修改标签页**：显示所有需要更新的文件
- **删除标签页**：显示所有需要删除的文件（如果启用同步）
- **相同标签页**：显示所有无需处理的文件

## ⚠️ 安全注意事项

### 1. 删除操作警告
- 删除云端文件的操作**不可撤销**
- 建议在重要操作前备份云端数据
- 仔细检查删除文件列表，确保没有误删重要文件

### 2. 网络连接要求
- 确保网络连接稳定，避免上传过程中断
- 大文件上传可能需要较长时间，请耐心等待
- 如果上传失败，可以重新尝试（已上传的文件会被跳过）

### 3. 权限验证
- 确保 API 密钥配置正确
- 检查服务器连接状态
- 验证对目标版本类型的操作权限

## 🔧 技术实现

### 文件对比算法
```
1. 扫描本地文件夹，计算每个文件的 SHA256 哈希值
2. 获取云端对应版本的文件列表和哈希值
3. 对比本地和云端文件：
   - 本地有，云端无 → 新增文件
   - 本地有，云端有，哈希不同 → 修改文件
   - 本地无，云端有 → 删除文件（如果启用同步）
   - 本地有，云端有，哈希相同 → 相同文件
```

### API 端点
- `GET /api/v2/files/simple/{version_type}` - 获取云端文件列表
- `POST /api/v2/upload/simple/file` - 上传单个文件
- `POST /api/v2/sync/simple/{version_type}` - 同步删除云端文件
- `DELETE /api/v2/files/simple/{version_type}` - 删除指定文件

## 🐛 故障排除

### 常见问题

1. **"无法连接到服务器"**
   - 检查服务器是否正在运行
   - 验证服务器地址和端口配置
   - 检查网络连接

2. **"API 密钥无效"**
   - 检查配置文件中的 API 密钥
   - 确认密钥格式正确
   - 联系管理员获取有效密钥

3. **"差异分析失败"**
   - 检查文件夹路径是否正确
   - 确认文件夹可读权限
   - 查看错误日志获取详细信息

4. **"上传部分文件失败"**
   - 检查文件是否被其他程序占用
   - 验证文件大小是否超过限制
   - 重新尝试上传失败的文件

### 日志查看
- 上传工具会记录详细的操作日志
- 日志包含文件处理状态、错误信息、性能统计
- 可以通过日志追踪问题原因

## 📈 性能优化

### 上传效率
- 增量上传可以显著减少上传时间
- 对于大型项目，通常只有 10-30% 的文件发生变化
- SHA256 计算在本地进行，减少网络传输

### 网络优化
- 支持并发上传多个文件（未来版本）
- 自动重试失败的上传
- 压缩传输减少带宽使用

## 🔄 版本兼容性

- 兼容现有的简化版本管理系统
- 支持 stable/beta/alpha 三种版本类型
- 向后兼容传统的完整上传模式
- 可以与现有的下载工具无缝配合

---

**注意**：增量上传功能需要服务器端支持相应的 API 端点。确保服务器已更新到最新版本。
