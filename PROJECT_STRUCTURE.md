# Omegaæ›´æ–°ç³»ç»Ÿé¡¹ç›®ç»“æ„ - å¢å¼ºç‰ˆ

æœ¬æ–‡æ¡£æè¿°äº†Omegaæ›´æ–°ç³»ç»Ÿå¢å¼ºç‰ˆçš„å®Œæ•´é¡¹ç›®ç»“æ„å’Œå„ä¸ªç»„ä»¶çš„åŠŸèƒ½ã€‚

## ğŸ“ é¡¹ç›®æ ¹ç›®å½•ç»“æ„

```
omega-update/
â”œâ”€â”€ README.md                    # é¡¹ç›®è¯´æ˜æ–‡æ¡£
â”œâ”€â”€ PROJECT_STRUCTURE.md         # é¡¹ç›®ç»“æ„è¯´æ˜ï¼ˆæœ¬æ–‡ä»¶ï¼‰
â”œâ”€â”€ DEPLOYMENT_GUIDE.md          # è¯¦ç»†éƒ¨ç½²æŒ‡å—
â”œâ”€â”€ API_DOCUMENTATION.md         # å®Œæ•´APIæ–‡æ¡£
â”œâ”€â”€ Pipfile                      # Pythonä¾èµ–ç®¡ç†æ–‡ä»¶
â”œâ”€â”€ Pipfile.lock                 # é”å®šçš„ä¾èµ–ç‰ˆæœ¬
â”œâ”€â”€ enhanced_database.py         # å¢å¼ºæ•°æ®åº“æ¨¡å‹
â”œâ”€â”€ storage_manager.py           # å­˜å‚¨ç®¡ç†å™¨
â”œâ”€â”€ enhanced_main.py             # å¢å¼ºç‰ˆAPIæœåŠ¡
â”œâ”€â”€ advanced_upload_gui.py       # é«˜çº§GUIå·¥å…·
â”œâ”€â”€ deploy_enhanced_version.ps1  # éƒ¨ç½²è„šæœ¬
â”œâ”€â”€ storage_management_strategy.md # å­˜å‚¨ç®¡ç†ç­–ç•¥
â”œâ”€â”€ deployment/                  # éƒ¨ç½²ç›¸å…³æ–‡ä»¶
â””â”€â”€ update_server/               # åŸå§‹æœåŠ¡å™¨ç«¯ä»£ç 
```

## ğŸ”§ æ ¸å¿ƒç»„ä»¶è¯¦è§£

### 1. å¢å¼ºç‰ˆæ ¸å¿ƒæ–‡ä»¶

#### enhanced_database.py
- **åŠŸèƒ½**: å¢å¼ºçš„æ•°æ®åº“æ¨¡å‹å®šä¹‰
- **ç‰¹æ€§**:
  - æ”¯æŒå¤šç§åŒ…ç±»å‹ (FULL/PATCH/HOTFIX)
  - å­˜å‚¨ç»Ÿè®¡å’Œæ¸…ç†å†å²
  - ä¸‹è½½æ—¥å¿—å’ŒæœåŠ¡å™¨é…ç½®
  - è‡ªåŠ¨åˆå§‹åŒ–å’Œé…ç½®ç®¡ç†

#### storage_manager.py
- **åŠŸèƒ½**: æ™ºèƒ½å­˜å‚¨ç©ºé—´ç®¡ç†
- **ç‰¹æ€§**:
  - å®æ—¶å­˜å‚¨ç›‘æ§
  - è‡ªåŠ¨æ¸…ç†ç­–ç•¥
  - ç‰ˆæœ¬ä¿æŠ¤æœºåˆ¶
  - å­˜å‚¨å¥åº·æ£€æŸ¥

#### enhanced_main.py
- **åŠŸèƒ½**: å¢å¼ºç‰ˆFastAPIæœåŠ¡å™¨
- **ç‰¹æ€§**:
  - å¤šç±»å‹åŒ…ä¸Šä¼ æ”¯æŒ
  - æ™ºèƒ½ç‰ˆæœ¬æ£€æŸ¥
  - å­˜å‚¨ç®¡ç†API
  - å¤§æ–‡ä»¶ä¸Šä¼ ä¼˜åŒ–

#### advanced_upload_gui.py
- **åŠŸèƒ½**: é«˜çº§å›¾å½¢ç•Œé¢ç®¡ç†å·¥å…·
- **ç‰¹æ€§**:
  - åŒ…ç±»å‹é€‰æ‹©ç•Œé¢
  - å­˜å‚¨çŠ¶æ€ç›‘æ§
  - æ‰¹é‡æ“ä½œæ”¯æŒ
  - å®æ—¶æ—¥å¿—æ˜¾ç¤º

### 2. éƒ¨ç½²å’Œé…ç½®

#### deploy_enhanced_version.ps1
- **åŠŸèƒ½**: è‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬
- **ç‰¹æ€§**:
  - ä¸€é”®éƒ¨ç½²åˆ°æœåŠ¡å™¨
  - è‡ªåŠ¨å¤‡ä»½å’Œå›æ»š
  - æœåŠ¡é…ç½®å’Œå¯åŠ¨
  - åŠŸèƒ½éªŒè¯æµ‹è¯•

#### storage_management_strategy.md
- **åŠŸèƒ½**: å­˜å‚¨ç®¡ç†ç­–ç•¥æ–‡æ¡£
- **å†…å®¹**:
  - 40GBå­˜å‚¨åˆ†é…ç­–ç•¥
  - ç‰ˆæœ¬ä¿ç•™è§„åˆ™
  - è‡ªåŠ¨æ¸…ç†æœºåˆ¶
  - ç›‘æ§å’Œå‘Šè­¦é…ç½®

### 3. éƒ¨ç½²ç›®å½• (deployment/)

```
deployment/
â”œâ”€â”€ server_config.json           # æœåŠ¡å™¨é…ç½®æ–‡ä»¶
â”œâ”€â”€ server_config.py            # æœåŠ¡å™¨é…ç½®æ¨¡å—
â”œâ”€â”€ nginx.conf                  # Nginxé…ç½®æ–‡ä»¶
â”œâ”€â”€ omega-update-server.service # systemdæœåŠ¡æ–‡ä»¶
â”œâ”€â”€ deploy.sh                   # Linuxéƒ¨ç½²è„šæœ¬
â”œâ”€â”€ quick_deploy.sh             # å¿«é€Ÿéƒ¨ç½²è„šæœ¬
â”œâ”€â”€ auto_server_setup.ps1       # è‡ªåŠ¨æœåŠ¡å™¨è®¾ç½®
â”œâ”€â”€ auto_server_config.ps1      # è‡ªåŠ¨æœåŠ¡å™¨é…ç½®
â”œâ”€â”€ diagnose.sh                 # è¯Šæ–­è„šæœ¬
â”œâ”€â”€ fix_common_issues.sh        # å¸¸è§é—®é¢˜ä¿®å¤
â”œâ”€â”€ fix_server_limits.sh        # æœåŠ¡å™¨é™åˆ¶ä¿®å¤
â”œâ”€â”€ set_permissions.ps1         # æƒé™è®¾ç½®è„šæœ¬
â”œâ”€â”€ manual_commands.txt         # æ‰‹åŠ¨å‘½ä»¤å‚è€ƒ
â”œâ”€â”€ gui_config.json             # GUIé…ç½®æ–‡ä»¶
â””â”€â”€ æ–‡æ¡£ç›®å½•/
    â”œâ”€â”€ DEPLOYMENT_CHECKLIST.md # éƒ¨ç½²æ£€æŸ¥æ¸…å•
    â”œâ”€â”€ GUI_USAGE.md            # GUIä½¿ç”¨æŒ‡å—
    â”œâ”€â”€ MANUAL_UPLOAD.md        # æ‰‹åŠ¨ä¸Šä¼ æŒ‡å—
    â”œâ”€â”€ QUICK_START.md          # å¿«é€Ÿå¼€å§‹æŒ‡å—
    â”œâ”€â”€ README.md               # éƒ¨ç½²è¯´æ˜
    â”œâ”€â”€ SIMPLE_DEPLOY_GUIDE.md  # ç®€åŒ–éƒ¨ç½²æŒ‡å—
    â””â”€â”€ WINDOWS_DEPLOY.md       # Windowséƒ¨ç½²æŒ‡å—
```

### 4. åŸå§‹æœåŠ¡å™¨ä»£ç  (update_server/)

```
update_server/
â”œâ”€â”€ api/                        # APIæ¥å£æ¨¡å—
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ routes.py              # è·¯ç”±å®šä¹‰
â”‚   â””â”€â”€ middleware.py          # ä¸­é—´ä»¶
â”œâ”€â”€ models/                     # æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ database.py            # æ•°æ®åº“æ¨¡å‹
â”‚   â””â”€â”€ schemas.py             # æ•°æ®æ¨¡å¼
â”œâ”€â”€ config/                     # é…ç½®æ¨¡å—
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ settings.py            # è®¾ç½®æ–‡ä»¶
â”œâ”€â”€ utils/                      # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ file_utils.py          # æ–‡ä»¶å·¥å…·
â”‚   â””â”€â”€ version_utils.py       # ç‰ˆæœ¬å·¥å…·
â””â”€â”€ static/                     # é™æ€æ–‡ä»¶
    â”œâ”€â”€ css/
    â”œâ”€â”€ js/
    â””â”€â”€ images/
```

## ğŸ”„ æ•°æ®æµæ¶æ„

### 1. ä¸Šä¼ æµç¨‹
```
GUIå·¥å…· â†’ enhanced_main.py â†’ storage_manager.py â†’ enhanced_database.py
    â†“
æ–‡ä»¶å­˜å‚¨ (/var/www/updates/)
```

### 2. ä¸‹è½½æµç¨‹
```
å®¢æˆ·ç«¯ â†’ Nginx â†’ enhanced_main.py â†’ æ–‡ä»¶ç³»ç»Ÿ
```

### 3. å­˜å‚¨ç®¡ç†æµç¨‹
```
å®šæ—¶ä»»åŠ¡ â†’ storage_manager.py â†’ æ¸…ç†ç­–ç•¥ â†’ æ–‡ä»¶åˆ é™¤ â†’ æ•°æ®åº“æ›´æ–°
```

## ğŸ“Š æ•°æ®åº“æ¶æ„

### ä¸»è¦è¡¨ç»“æ„

1. **versions** - ç‰ˆæœ¬ä¿¡æ¯
2. **packages** - æ›´æ–°åŒ…ä¿¡æ¯
3. **package_files** - åŒ…æ–‡ä»¶è¯¦æƒ…
4. **storage_stats** - å­˜å‚¨ç»Ÿè®¡
5. **cleanup_history** - æ¸…ç†å†å²
6. **download_logs** - ä¸‹è½½æ—¥å¿—
7. **server_config** - æœåŠ¡å™¨é…ç½®

### å…³ç³»å›¾
```
versions (1) â†â†’ (N) packages (1) â†â†’ (N) package_files
    â†“
storage_stats
    â†“
cleanup_history
```

## ğŸš€ éƒ¨ç½²æ¶æ„

### ç”Ÿäº§ç¯å¢ƒ
```
Internet â†’ Nginx (80/443) â†’ FastAPI (8000) â†’ SQLite/PostgreSQL
                â†“
        æ–‡ä»¶å­˜å‚¨ (/var/www/updates/)
```

### å¼€å‘ç¯å¢ƒ
```
æœ¬åœ° â†’ Pythonç›´æ¥è¿è¡Œ (8000) â†’ SQLite
```

## ğŸ“ é…ç½®æ–‡ä»¶è¯´æ˜

### 1. server_config.json
```json
{
  "server": {
    "ip": "æœåŠ¡å™¨IP",
    "domain": "åŸŸå"
  },
  "api": {
    "key": "APIå¯†é’¥"
  }
}
```

### 2. .envæ–‡ä»¶
```bash
API_KEY=apiå¯†é’¥
DATABASE_URL=æ•°æ®åº“è¿æ¥
MAX_FILE_SIZE=æœ€å¤§æ–‡ä»¶å¤§å°
LOG_LEVEL=æ—¥å¿—çº§åˆ«
```

### 3. Nginxé…ç½®è¦ç‚¹
- client_max_body_size: 1200M
- è¶…æ—¶è®¾ç½®: 1800s
- ä»£ç†é…ç½®: è½¬å‘åˆ°8000ç«¯å£

## ğŸ”§ å¼€å‘æŒ‡å—

### 1. æœ¬åœ°å¼€å‘ç¯å¢ƒè®¾ç½®
```bash
# å®‰è£…ä¾èµ–
pipenv install

# æ¿€æ´»ç¯å¢ƒ
pipenv shell

# è¿è¡ŒæœåŠ¡å™¨
python enhanced_main.py
```

### 2. æ·»åŠ æ–°åŠŸèƒ½
1. ä¿®æ”¹æ•°æ®åº“æ¨¡å‹ (enhanced_database.py)
2. æ›´æ–°å­˜å‚¨ç®¡ç† (storage_manager.py)
3. æ·»åŠ APIæ¥å£ (enhanced_main.py)
4. æ›´æ–°GUIç•Œé¢ (advanced_upload_gui.py)

### 3. æµ‹è¯•æµç¨‹
1. å•å…ƒæµ‹è¯•
2. é›†æˆæµ‹è¯•
3. GUIåŠŸèƒ½æµ‹è¯•
4. éƒ¨ç½²æµ‹è¯•

## ğŸ“ˆ æ‰©å±•è®¡åˆ’

### çŸ­æœŸç›®æ ‡
- [ ] æ”¯æŒæ›´å¤šæ–‡ä»¶æ ¼å¼
- [ ] å¢åŠ ç”¨æˆ·æƒé™ç®¡ç†
- [ ] ä¼˜åŒ–å¤§æ–‡ä»¶ä¸Šä¼ æ€§èƒ½

### é•¿æœŸç›®æ ‡
- [ ] æ”¯æŒåˆ†å¸ƒå¼å­˜å‚¨
- [ ] æ·»åŠ CDNé›†æˆ
- [ ] å®ç°è´Ÿè½½å‡è¡¡

## ğŸ” ç›‘æ§å’Œç»´æŠ¤

### 1. æ—¥å¿—æ–‡ä»¶ä½ç½®
- åº”ç”¨æ—¥å¿—: `/opt/omega-update-server/logs/`
- Nginxæ—¥å¿—: `/var/log/nginx/`
- ç³»ç»Ÿæ—¥å¿—: `journalctl -u omega-update-server`

### 2. ç›‘æ§æŒ‡æ ‡
- å­˜å‚¨ä½¿ç”¨ç‡
- APIå“åº”æ—¶é—´
- é”™è¯¯ç‡ç»Ÿè®¡
- ä¸‹è½½ç»Ÿè®¡

### 3. ç»´æŠ¤ä»»åŠ¡
- å®šæœŸæ•°æ®åº“æ¸…ç†
- æ—¥å¿—è½®è½¬
- å­˜å‚¨ç©ºé—´ç›‘æ§
- å®‰å…¨æ›´æ–°

---

è¿™ä¸ªé¡¹ç›®ç»“æ„æ”¯æŒä»ç®€å•çš„æ–‡ä»¶æ›´æ–°åˆ°å¤æ‚çš„ä¼ä¸šçº§éƒ¨ç½²éœ€æ±‚ã€‚é€šè¿‡æ¨¡å—åŒ–è®¾è®¡ï¼Œå¯ä»¥æ ¹æ®å…·ä½“éœ€æ±‚é€‰æ‹©ä½¿ç”¨ç›¸åº”çš„ç»„ä»¶ã€‚
