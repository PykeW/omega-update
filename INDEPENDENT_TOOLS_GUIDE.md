# Omega更新服务器 - 独立工具使用指南

## 概述

Omega更新服务器现在提供两个独立的GUI工具，分别专注于不同的功能：

- **上传工具 (upload_tool.py)** - 专门用于文件上传、存储管理和版本控制
- **下载工具 (download_tool.py)** - 专门用于文件下载、更新检查和版本同步

两个工具完全独立运行，共享相同的服务器配置，但功能互不干扰。

## 🚀 快速启动

### Windows系统

#### 启动上传工具
```bash
# 方法1: 双击启动脚本
start_upload_tool.bat

# 方法2: 命令行启动
python upload_tool.py
```

#### 启动下载工具
```bash
# 方法1: 双击启动脚本
start_download_tool.bat

# 方法2: 命令行启动
python download_tool.py
```

### Linux/macOS系统

#### 启动上传工具
```bash
# 方法1: 使用启动脚本
chmod +x start_upload_tool.sh
./start_upload_tool.sh

# 方法2: 直接启动
python3 upload_tool.py
```

#### 启动下载工具
```bash
# 方法1: 使用启动脚本
chmod +x start_download_tool.sh
./start_download_tool.sh

# 方法2: 直接启动
python3 download_tool.py
```

## 📤 上传工具详细说明

### 主要功能

1. **文件夹上传** - 将本地文件夹逐个文件上传到服务器
2. **存储管理** - 监控存储使用情况，执行清理操作
3. **包列表查看** - 查看已上传的所有版本包
4. **版本管理** - 配置版本保留策略，管理历史版本
5. **文件验证** - 验证服务器文件的完整性

### 界面布局

```
┌─────────────────────────────────────────────────────────┐
│ Omega更新服务器 - 上传工具 v3.0                          │
├─────────────────────────────────────────────────────────┤
│ 存储状态: 显示当前存储使用情况和健康状态                   │
├─────────────────────────────────────────────────────────┤
│ 包类型: ○ 完整包  ○ 增量包  ○ 热修复包                   │
├─────────────────────────────────────────────────────────┤
│ 版本信息: 版本号、平台、架构、描述                        │
├─────────────────────────────────────────────────────────┤
│ 文件夹选择: [选择文件夹] [预览内容]                       │
├─────────────────────────────────────────────────────────┤
│ 选项: ☑ 稳定版本  ☐ 关键更新                            │
├─────────────────────────────────────────────────────────┤
│ [上传] [清理存储] [查看包列表] [存储管理] [退出]           │
├─────────────────────────────────────────────────────────┤
│ 进度和日志区域                                           │
└─────────────────────────────────────────────────────────┘
```

### 使用步骤

1. **选择包类型**
   - 完整包：包含所有文件的完整版本
   - 增量包：相对于某个版本的差异文件
   - 热修复包：紧急修复的小型更新

2. **填写版本信息**
   - 版本号：如 "v1.0.0"、"2024.01.15" 等
   - 平台：windows、linux、macos
   - 架构：x64、x86、arm64
   - 描述：版本更新说明

3. **选择文件夹**
   - 点击"选择文件夹"选择要上传的目录
   - 点击"预览内容"查看文件夹结构
   - 系统会自动分析文件数量和大小

4. **设置选项**
   - 稳定版本：标记为稳定发布版本
   - 关键更新：标记为重要安全更新

5. **开始上传**
   - 点击"上传"按钮开始上传
   - 实时查看上传进度和日志
   - 支持断点续传和错误重试

### 存储管理功能

#### 存储结构查看
- 查看服务器上的完整目录结构
- 显示每个版本的文件数量和大小
- 按平台和架构分类显示

#### 版本保留策略
- 配置每种包类型保留的版本数量
- 自动清理超出保留数量的旧版本
- 支持手动应用清理策略

#### 文件验证
- 验证服务器文件的SHA256哈希值
- 检查文件完整性和一致性
- 发现损坏文件并提供修复建议

## 📥 下载工具详细说明

### 主要功能

1. **本地文件扫描** - 扫描本地文件夹并计算哈希值
2. **更新检查** - 对比本地与服务器文件差异
3. **选择性下载** - 用户可选择要下载的特定文件
4. **断点续传** - 网络中断后可继续下载
5. **进度跟踪** - 详细的下载进度和速度统计

### 界面布局

```
┌─────────────────────────────────────────────────────────┐
│ Omega更新服务器 - 下载工具 v3.0                          │
├─────────────────────────────────────────────────────────┤
│ ┌─检查更新─┐ ┌─下载管理─┐                               │
│ │                                                     │ │
│ │ 本地文件夹: [选择文件夹]                             │ │
│ │ 目标版本: 版本号 | 平台 | 架构                       │ │
│ │ [扫描本地文件] [检查更新]                            │ │
│ │                                                     │ │
│ │ 检查结果:                                           │ │
│ │ ├─需要下载 (5个文件)                                │ │
│ │ │  ├─app.exe (新增)                                 │ │
│ │ │  └─config.json (更新)                             │ │
│ │ ├─相同文件 (10个文件)                               │ │
│ │ └─需要删除 (2个文件)                                │ │
│ │                                                     │ │
│ │ [下载选中文件] [下载全部更新]                        │ │
│ └─────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────┘
```

### 使用步骤

1. **选择本地文件夹**
   - 点击"选择文件夹"选择要更新的本地目录
   - 这是将要与服务器版本同步的文件夹

2. **设置目标版本**
   - 版本号：要下载的目标版本
   - 平台：与服务器上传时的平台一致
   - 架构：与服务器上传时的架构一致

3. **扫描本地文件**
   - 点击"扫描本地文件"分析本地文件状态
   - 系统会计算所有文件的SHA256哈希值
   - 显示扫描进度和结果

4. **检查更新**
   - 点击"检查更新"对比本地与服务器差异
   - 系统会显示详细的差异分析结果
   - 文件按状态分类显示

5. **选择下载内容**
   - 在差异结果中选择要下载的文件
   - 可以选择单个文件或整个分类
   - 支持批量选择和全选操作

6. **开始下载**
   - 点击"下载选中文件"或"下载全部更新"
   - 切换到"下载管理"标签页查看进度
   - 支持暂停、继续、取消操作

### 下载管理功能

#### 进度显示
- 当前文件下载进度
- 总体下载进度
- 实时下载速度
- 预估剩余时间

#### 统计信息
- 已完成文件数量
- 失败文件数量
- 跳过文件数量
- 总文件数量

#### 控制操作
- 暂停下载：临时停止下载
- 继续下载：恢复暂停的下载
- 取消下载：终止所有下载任务

## ⚙️ 配置文件

### 配置文件位置

工具会按以下优先级查找配置文件：

1. `local_server_config.json` (本地配置，优先级最高)
2. `deployment/server_config.json` (部署配置)
3. 内置默认配置

### 配置文件格式

```json
{
    "server": {
        "ip": "106.14.28.97",
        "domain": "your-domain.com",
        "port": 8000
    },
    "api": {
        "key": "your-api-key-here"
    }
}
```

### 创建本地配置

建议创建 `local_server_config.json` 文件：

```bash
# 复制示例配置
cp deployment/server_config.json local_server_config.json

# 编辑配置
notepad local_server_config.json  # Windows
nano local_server_config.json     # Linux/macOS
```

## 🔧 系统要求

### 软件要求

- **Python**: 3.7 或更高版本
- **操作系统**: Windows 10+, Ubuntu 18.04+, macOS 10.14+
- **内存**: 最少 512MB 可用内存
- **存储**: 最少 100MB 可用空间

### Python依赖包

工具使用Python标准库，无需额外安装依赖包：

- `tkinter` - GUI界面
- `requests` - HTTP请求
- `threading` - 多线程处理
- `pathlib` - 路径操作
- `hashlib` - 哈希计算
- `json` - JSON处理

### 网络要求

- 能够访问Omega更新服务器
- 上传工具需要稳定的上行带宽
- 下载工具需要稳定的下行带宽
- 防火墙允许HTTP/HTTPS连接

## 🚨 故障排除

### 常见问题

#### 1. Python未找到
```
错误: 未找到Python，请先安装Python 3.7+
```
**解决方案**: 安装Python并确保添加到系统PATH

#### 2. 配置文件错误
```
错误: 配置文件格式错误
```
**解决方案**: 检查JSON格式，确保语法正确

#### 3. 网络连接失败
```
错误: 无法连接到服务器
```
**解决方案**: 
- 检查服务器地址和端口
- 确认网络连接正常
- 检查防火墙设置

#### 4. API密钥无效
```
错误: 无效的API密钥
```
**解决方案**: 确认API密钥正确，联系管理员获取

#### 5. 文件权限错误
```
错误: 文件写入权限不足
```
**解决方案**: 
- 以管理员身份运行工具
- 检查目标文件夹权限
- 选择有写入权限的文件夹

### 日志查看

两个工具都提供详细的日志信息：

- **GUI日志**: 在工具界面的日志区域查看
- **控制台日志**: 在命令行窗口查看
- **错误信息**: 通过弹窗提示显示

### 获取帮助

如果遇到问题，请：

1. 查看工具界面的日志信息
2. 检查配置文件是否正确
3. 确认网络连接正常
4. 联系系统管理员

## 📋 最佳实践

### 上传工具使用建议

1. **版本命名规范**
   - 使用语义化版本号：v1.0.0, v1.0.1
   - 包含日期信息：2024.01.15
   - 避免特殊字符和空格

2. **文件夹组织**
   - 保持清晰的目录结构
   - 移除临时文件和缓存
   - 确保文件权限正确

3. **存储管理**
   - 定期清理旧版本
   - 监控存储使用情况
   - 配置合理的保留策略

### 下载工具使用建议

1. **更新前准备**
   - 备份重要文件
   - 关闭相关应用程序
   - 确保足够的磁盘空间

2. **网络环境**
   - 使用稳定的网络连接
   - 避免在网络高峰期下载
   - 考虑使用有线连接

3. **文件管理**
   - 定期验证文件完整性
   - 保持本地文件夹整洁
   - 及时处理冲突文件

---

**版本**: 3.0.0  
**更新日期**: 2025-07-13  
**适用系统**: Windows, Linux, macOS  
**支持**: Omega更新服务器团队
